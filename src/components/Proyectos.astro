---
const proyectos = await Astro.glob("../pages/proyectos/*.md");
---

<div class="container relative grid place-items-center mb-10">
  <article
    class="w-full h-fit flex items-center flex-col md:gap-14 gap-10 [&>p]:text-dark-light [&>p]:dark:text-light-dark [&>p]:xl:text-base [&>p]:md:text-base [&>p]:text-sm"
  >
    <div>
      <h2
        class="titulo 2xl:text-7xl xl:text-6xl lg:text-5xl sm:text-5xl text-4xl font-bold sm:text-center text-left text-dark dark:text-light relative z-20"
      >
        Mis Proyectos
      </h2>
      <p class="sm:text-center text-left text-dark-light dark:text-light-dark mt-4">
        Estas son algunas de las paginas web que he realizado.
      </p>
    </div>
  </article>
</div>
<div
  draggable="false"
  id="carousel"
  class="relative w-full h-auto 2xl:aspect-[12/4] xl:aspect-[12/5] lg:aspect-[12/6] md:aspect-[12/8] sm:aspect-[12/10] aspect-auto m-0 sm:overflow-hidden"
>
  <ul
    draggable="false"
    id="image-track"
    data-mouse-down-at="0"
    data-prev-percentage="0"
    class="sm:absolute flex sm:flex-row flex-col sm:min-w-max gap-16 sm:h-full h-min sm:w-auto left-1/2 w-full select-none cursor-grab"
  >
    {
      proyectos.map((proyecto) => (
        <li class="sm:grid flex flex-col sm:grid-cols-2 sm:gap-5 items-center justify-items-center sm:aspect-[4/2] aspect-auto sm:w-auto w-full sm:px-0 px-4 sm:h-auto">
          <img
            class="sm:h-full rounded object-cover w-auto sm:aspect-auto aspect-[1/1] bg-light"
            src={proyecto.frontmatter.image.url}
            alt={proyecto.frontmatter.image.alt}
            draggable="false"
          />
          <div class="sm:h-auto h-min flex flex-col sm:gap-8 gap-4 items-start sm:px-3 sm:py-5 py-5">
            <h3 class="2xl:text-4xl xl:text-4xl lg:text-3xl sm:text-2xl text-xl font-bold text-dark dark:text-light relative z-20">
              {proyecto.frontmatter.title}
            </h3>
            <div class="text-dark-light dark:text-light-dark text-base font-light">
              <slot set:html={proyecto.compiledContent()}>
            </div>
            <div class="flex sm:gap-6 gap-4">
              <a
                target="_blank"
                class="sm:text-lg text-sm flex sm:gap-2 gap-1 items-center w-fit dark:text-dark text-light bg-dark dark:bg-light px-4 py-2 md:px-9 lg:px-5 xl:px-6 2xl:px-7 sm:border-none border border-dark font-medium"
                href={proyecto.frontmatter.urls.pagina}
              >
                Ver Pagina<svg height="512px" class="w-auto h-10 dark:invert-0 invert" id="Layer_1" style="enable-background:new 0 0 512 512;" version="1.1" viewBox="0 0 512 512" width="512px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink"><g><g><path d="M447.1,256.2C401.8,204,339.2,144,256,144c-33.6,0-64.4,9.5-96.9,29.8C131.7,191,103.6,215.2,65,255l-1,1l6.7,6.9    C125.8,319.3,173.4,368,256,368c36.5,0,71.9-11.9,108.2-36.4c30.9-20.9,57.2-47.4,78.3-68.8l5.5-5.5L447.1,256.2z M256,160    c33.1,0,64.9,9.5,97.2,30.6c23.9,15.6,47.4,36.7,73.7,66.1C388.6,295.4,331.1,352,256,352c-34.2,0-64.2-8.4-94.2-28.2    c-27.5-18.1-52.3-43.3-76.2-67.8C144.7,196.3,194,160,256,160z"/><path d="M256,336c44.1,0,80-35.9,80-80c0-44.1-35.9-80-80-80c-44.1,0-80,35.9-80,80C176,300.1,211.9,336,256,336z M256,192.3    c35.2,0,64,28.6,64,63.7c0,35.1-28.8,63.7-64,63.7c-35.2,0-63.9-28.6-63.9-63.7C192.1,220.9,220.8,192.3,256,192.3z"/></g><path d="M288,256L288,256c0,17.5-14.4,32-31.8,32S224,272.8,224,255.3s15.8-31.3,32-31.3l0-16c-26.5,0-47.9,21.6-47.9,48.2   c0,26.6,21.5,48.1,47.9,48.1s48-21.6,48-48.1V256H288z"/></g></svg>
              </a>
              <a
                target="_blank"
                class="flex sm:text-lg text-sm sm:gap-2 gap-1 items-center w-fit text-dark dark:text-light px-4 py-2 md:px-9 lg:px-5 xl:px-6 2xl:px-7 border border-dark dark:border-light"
                href={proyecto.frontmatter.urls.codigo}
              >
                Ver CÃ³digo<svg viewBox="0 0 384 512" class="w-auto h-6 invert-0 dark:invert" xmlns="http://www.w3.org/2000/svg"><path d="M384 144c0-44.2-35.8-80-80-80s-80 35.8-80 80c0 36.4 24.3 67.1 57.5 76.8-.6 16.1-4.2 28.5-11 36.9-15.4 19.2-49.3 22.4-85.2 25.7-28.2 2.6-57.4 5.4-81.3 16.9v-144c32.5-10.2 56-40.5 56-76.3 0-44.2-35.8-80-80-80S0 35.8 0 80c0 35.8 23.5 66.1 56 76.3v199.3C23.5 365.9 0 396.2 0 432c0 44.2 35.8 80 80 80s80-35.8 80-80c0-34-21.2-63.1-51.2-74.6 3.1-5.2 7.8-9.8 14.9-13.4 16.2-8.2 40.4-10.4 66.1-12.8 42.2-3.9 90-8.4 118.2-43.4 14-17.4 21.1-39.8 21.6-67.9 31.6-10.8 54.4-40.7 54.4-75.9zM80 64c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16zm0 384c-8.8 0-16-7.2-16-16s7.2-16 16-16 16 7.2 16 16-7.2 16-16 16zm224-320c8.8 0 16 7.2 16 16s-7.2 16-16 16-16-7.2-16-16 7.2-16 16-16z"/></svg>
              </a>
            </div>
          </div>
        </li>
      ))
    }
  </ul>
</div>

<style>
  h3,
  p {
    text-wrap: balance;
  }
</style>

<script async>
const track = document.getElementById("image-track");
const carousel = document.getElementById("carousel");

const handleOnDown = (e) => (track.dataset.mouseDownAt = e.clientX);

const handleOnUp = () => {
  track.dataset.mouseDownAt = "0";
  track.dataset.prevPercentage = track.dataset.percentage;
};

const handleOnMove = (e) => {
  if (window.innerWidth < 640) return;
  if (track.dataset.mouseDownAt === "0") return;
  const mouseDelta = parseFloat(track.dataset.mouseDownAt) - e.clientX,
    maxDelta = window.innerWidth / 2;
  const percentage = (mouseDelta / maxDelta) * -100,
    nextPercentageUnconstrained =
      parseFloat(track.dataset.prevPercentage) + percentage,
    nextPercentage = Math.max(Math.min(nextPercentageUnconstrained, 0), -100);
  track.dataset.percentage = nextPercentage;

  track.animate(
    {
      transform: `translate(${nextPercentage}%, 0%)`,
    },
    { duration: 1200, fill: "forwards" }
  );
};

/* -- Had to add extra lines for touch events -- */

carousel.onmousedown = (e) => handleOnDown(e);

carousel.ontouchstart = (e) => handleOnDown(e.touches[0]);

carousel.onmouseup = (e) => handleOnUp(e);

carousel.ontouchend = (e) => handleOnUp(e.touches[0]);

carousel.onmousemove = (e) => handleOnMove(e);

carousel.ontouchmove = (e) => handleOnMove(e.touches[0]);
</script>
